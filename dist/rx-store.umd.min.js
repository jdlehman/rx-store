!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("rx-store",["exports"],e):e(t.RxStore=t.RxStore||{})}(this,function(t){"use strict";function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}function r(t){return"function"==typeof t}function n(t){return null!=t&&"object"===("undefined"==typeof t?"undefined":m(t))}function o(){try{return w.apply(this,arguments)}catch(t){return U.errorObject.e=t,U.errorObject}}function i(t){return w=t,o}function s(t,e,r){if(t){if(t instanceof ct.Subscriber)return t;if(t[ut.$$rxSubscriber])return t[ut.$$rxSubscriber]()}return t||e||r?new ct.Subscriber(t,e,r):new ct.Subscriber(ht.empty)}function c(t){var e,r=t.Symbol;return"function"==typeof r?r.observable?e=r.observable:(e=r("observable"),r.observable=e):e="@@observable",e}function u(t){return t&&"function"==typeof t.schedule}function h(t){return t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}function a(t){var e=t.Symbol;if("function"==typeof e)return e.iterator||(e.iterator=e("iterator polyfill")),e.iterator;var r=t.Set;if(r&&"function"==typeof(new r)["@@iterator"])return"@@iterator";var n=t.Map;if(n)for(var o=Object.getOwnPropertyNames(n.prototype),i=0;i<o.length;++i){var s=o[i];if("entries"!==s&&"size"!==s&&n.prototype[s]===n.prototype.entries)return s}return"@@iterator"}function p(t,e,r,n){var o=new Ue.InnerSubscriber(t,r,n);if(o.closed)return null;if(e instanceof Te.Observable)return e._isScalar?(o.next(e.value),o.complete(),null):e.subscribe(o);if(ge.isArray(e)){for(var i=0,s=e.length;i<s&&!o.closed;i++)o.next(e[i]);o.closed||o.complete()}else{if(je.isPromise(e))return e.then(function(t){o.closed||(o.next(t),o.complete())},function(t){return o.error(t)}).then(null,function(t){Ee.root.setTimeout(function(){throw t})}),o;if(e&&"function"==typeof e[$e.$$iterator])for(var c=e[$e.$$iterator]();;){var u=c.next();if(u.done){o.complete();break}if(o.next(u.value),o.closed)break}else if(e&&"function"==typeof e[Ae.$$observable]){var h=e[Ae.$$observable]();if("function"==typeof h.subscribe)return h.subscribe(new Ue.InnerSubscriber(t,r,n));o.error(new TypeError("Provided object does not correctly implement Symbol.observable"))}else{var a=Pe.isObject(e)?"an invalid object":"'"+e+"'",p="You provided "+a+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";o.error(new TypeError(p))}}return null}function b(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),this.lift(new Ne(t))}function l(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return this.lift.call(f.apply(void 0,[this].concat(t)))}function f(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=null,n=t;return Je.isScheduler(n[t.length-1])&&(r=n.pop()),null===r&&1===t.length?t[0]:new qe.ArrayObservable(t,r).lift(new Be.MergeAllOperator(1))}function d(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=t[t.length-1];Ze.isScheduler(r)?t.pop():r=null;var n=t.length;return 1===n?Xe.concatStatic(new Le.ScalarObservable(t[0],r),this):n>1?Xe.concatStatic(new Ke.ArrayObservable(t,r),this):Xe.concatStatic(new Qe.EmptyObservable(r),this)}function y(t,e){var r=!1;return arguments.length>=2&&(r=!0),this.lift(new cr(t,e,r))}function v(t,e){var r=new Ft,n=r.startWith(e).scan(t);return{action$:r,state$:n,dispatch:function(t){return r.next(t)},subscribe:function(){return n.subscribe.apply(n,arguments)}}}var w,_="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},S=e(function(t,e){if(e.root="object"==("undefined"==typeof window?"undefined":m(window))&&window.window===window&&window||"object"==("undefined"==typeof self?"undefined":m(self))&&self.self===self&&self||"object"==m(_)&&_.global===_&&_,!e.root)throw new Error("RxJS could not find any global context (window, self, global)")}),x=r,O={isFunction:x},E=Array.isArray||function(t){return t&&"number"==typeof t.length},g={isArray:E},j=n,P={isObject:j},T={e:{}},$={errorObject:T},U=$,A=i,I={tryCatch:A},M=_&&_.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},k=function(t){function e(e){t.call(this),this.errors=e;var r=Error.call(this,e?e.length+" errors occurred during unsubscription:\n  "+e.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"");this.name=r.name="UnsubscriptionError",this.stack=r.stack,this.message=r.message}return M(e,t),e}(Error),R=k,Y={UnsubscriptionError:R},C=g,N=P,V=O,F=I,W=$,z=Y,J=function(){function t(t){this.closed=!1,t&&(this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var t,e=!1;if(!this.closed){this.closed=!0;var r=this,n=r._unsubscribe,o=r._subscriptions;if(this._subscriptions=null,V.isFunction(n)){var i=F.tryCatch(n).call(this);i===W.errorObject&&(e=!0,(t=t||[]).push(W.errorObject.e))}if(C.isArray(o))for(var s=-1,c=o.length;++s<c;){var u=o[s];if(N.isObject(u)){var i=F.tryCatch(u.unsubscribe).call(u);if(i===W.errorObject){e=!0,t=t||[];var h=W.errorObject.e;h instanceof z.UnsubscriptionError?t=t.concat(h.errors):t.push(h)}}}if(e)throw new z.UnsubscriptionError(t)}},t.prototype.add=function(e){if(!e||e===t.EMPTY)return t.EMPTY;if(e===this)return this;var r=e;switch("undefined"==typeof e?"undefined":m(e)){case"function":r=new t(e);case"object":if(r.closed||"function"!=typeof r.unsubscribe)break;this.closed?r.unsubscribe():(this._subscriptions||(this._subscriptions=[])).push(r);break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}return r},t.prototype.remove=function(e){if(null!=e&&e!==this&&e!==t.EMPTY){var r=this._subscriptions;if(r){var n=r.indexOf(e);n!==-1&&r.splice(n,1)}}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}(),q=J,B={Subscription:q},D={closed:!0,next:function(t){},error:function(t){throw t},complete:function(){}},G={empty:D},H=S,K=H.root.Symbol,L="function"==typeof K&&"function"==typeof K.for?K.for("rxSubscriber"):"@@rxSubscriber",Q={$$rxSubscriber:L},X=_&&_.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},Z=O,tt=B,et=G,rt=Q,nt=function(t){function e(r,n,o){switch(t.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=et.empty;break;case 1:if(!r){this.destination=et.empty;break}if("object"===("undefined"==typeof r?"undefined":m(r))){r instanceof e?(this.destination=r,this.destination.add(this)):(this.syncErrorThrowable=!0,this.destination=new it(this,r));break}default:this.syncErrorThrowable=!0,this.destination=new it(this,r,n,o)}}return X(e,t),e.prototype[rt.$$rxSubscriber]=function(){return this},e.create=function(t,r,n){var o=new e(t,r,n);return o.syncErrorThrowable=!1,o},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e}(tt.Subscription),ot=nt,it=function(t){function e(e,r,n,o){t.call(this),this._parent=e;var i,s=this;Z.isFunction(r)?i=r:r&&(s=r,i=r.next,n=r.error,o=r.complete,Z.isFunction(s.unsubscribe)&&this.add(s.unsubscribe.bind(s)),s.unsubscribe=this.unsubscribe.bind(this)),this._context=s,this._next=i,this._error=n,this._complete=o}return X(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parent;e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parent;if(this._error)e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else{if(!e.syncErrorThrowable)throw this.unsubscribe(),t;e.syncErrorValue=t,e.syncErrorThrown=!0,this.unsubscribe()}}},e.prototype.complete=function(){if(!this.isStopped){var t=this._parent;this._complete?t.syncErrorThrowable?(this.__tryOrSetError(t,this._complete),this.unsubscribe()):(this.__tryOrUnsub(this._complete),this.unsubscribe()):this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){throw this.unsubscribe(),t}},e.prototype.__tryOrSetError=function(t,e,r){try{e.call(this._context,r)}catch(e){return t.syncErrorValue=e,t.syncErrorThrown=!0,!0}return!1},e.prototype._unsubscribe=function(){var t=this._parent;this._context=null,this._parent=null,t.unsubscribe()},e}(nt),st={Subscriber:ot},ct=st,ut=Q,ht=G,at=s,pt={toSubscriber:at},bt=S,lt=c,ft=c(bt.root),dt={getSymbolObservable:lt,$$observable:ft},yt=S,vt=pt,wt=dt,_t=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,o=vt.toSubscriber(t,e,r);if(n?n.call(o,this):o.add(this._subscribe(o)),o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},t.prototype.forEach=function(t,e){var r=this;if(e||(yt.root.Rx&&yt.root.Rx.config&&yt.root.Rx.config.Promise?e=yt.root.Rx.config.Promise:yt.root.Promise&&(e=yt.root.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,n){var o=r.subscribe(function(e){if(o)try{t(e)}catch(t){n(t),o.unsubscribe()}else t(e)},n,e)})},t.prototype._subscribe=function(t){return this.source.subscribe(t)},t.prototype[wt.$$observable]=function(){return this},t.create=function(e){return new t(e)},t}(),mt=_t,St={Observable:mt},xt=_&&_.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},Ot=function(t){function e(){var e=t.call(this,"object unsubscribed");this.name=e.name="ObjectUnsubscribedError",this.stack=e.stack,this.message=e.message}return xt(e,t),e}(Error),Et=Ot,gt={ObjectUnsubscribedError:Et},jt=_&&_.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},Pt=B,Tt=function(t){function e(e,r){t.call(this),this.subject=e,this.subscriber=r,this.closed=!1}return jt(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);r!==-1&&e.splice(r,1)}}},e}(Pt.Subscription),$t=Tt,Ut={SubjectSubscription:$t},At=_&&_.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},It=St,Mt=st,kt=B,Rt=gt,Yt=Ut,Ct=Q,Nt=function(t){function e(e){t.call(this,e),this.destination=e}return At(e,t),e}(Mt.Subscriber),Vt=function(t){function e(){t.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return At(e,t),e.prototype[Ct.$$rxSubscriber]=function(){return new Nt(this)},e.prototype.lift=function(t){var e=new Wt(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new Rt.ObjectUnsubscribedError;if(!this.isStopped)for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].next(t)},e.prototype.error=function(t){if(this.closed)throw new Rt.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,n=e.slice(),o=0;o<r;o++)n[o].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new Rt.ObjectUnsubscribedError;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),n=0;n<e;n++)r[n].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._subscribe=function(t){if(this.closed)throw new Rt.ObjectUnsubscribedError;return this.hasError?(t.error(this.thrownError),kt.Subscription.EMPTY):this.isStopped?(t.complete(),kt.Subscription.EMPTY):(this.observers.push(t),new Yt.SubjectSubscription(this,t))},e.prototype.asObservable=function(){var t=new It.Observable;return t.source=this,t},e.create=function(t,e){return new Wt(t,e)},e}(It.Observable),Ft=Vt,Wt=function(t){function e(e,r){t.call(this),this.destination=e,this.source=r}return At(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){var e=this.source;return e?this.source.subscribe(t):kt.Subscription.EMPTY},e}(Vt),zt=_&&_.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},Jt=St,qt=function(t){function e(e,r){t.call(this),this.value=e,this.scheduler=r,this._isScalar=!0,r&&(this._isScalar=!1)}return zt(e,t),e.create=function(t,r){return new e(t,r)},e.dispatch=function(t){var e=t.done,r=t.value,n=t.subscriber;return e?void n.complete():(n.next(r),void(n.closed||(t.done=!0,this.schedule(t))))},e.prototype._subscribe=function(t){var r=this.value,n=this.scheduler;return n?n.schedule(e.dispatch,0,{done:!1,value:r,subscriber:t}):(t.next(r),void(t.closed||t.complete()))},e}(Jt.Observable),Bt=qt,Dt={ScalarObservable:Bt},Gt=_&&_.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},Ht=St,Kt=function(t){function e(e){t.call(this),this.scheduler=e}return Gt(e,t),e.create=function(t){return new e(t)},e.dispatch=function(t){var e=t.subscriber;e.complete()},e.prototype._subscribe=function(t){var r=this.scheduler;return r?r.schedule(e.dispatch,0,{subscriber:t}):void t.complete()},e}(Ht.Observable),Lt=Kt,Qt={EmptyObservable:Lt},Xt=u,Zt={isScheduler:Xt},te=_&&_.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},ee=St,re=Dt,ne=Qt,oe=Zt,ie=function(t){function e(e,r){t.call(this),this.array=e,this.scheduler=r,r||1!==e.length||(this._isScalar=!0,this.value=e[0])}return te(e,t),e.create=function(t,r){return new e(t,r)},e.of=function(){for(var t=[],r=0;r<arguments.length;r++)t[r-0]=arguments[r];var n=t[t.length-1];oe.isScheduler(n)?t.pop():n=null;var o=t.length;return o>1?new e(t,n):1===o?new re.ScalarObservable(t[0],n):new ne.EmptyObservable(n)},e.dispatch=function(t){var e=t.array,r=t.index,n=t.count,o=t.subscriber;return r>=n?void o.complete():(o.next(e[r]),void(o.closed||(t.index=r+1,this.schedule(t))))},e.prototype._subscribe=function(t){var r=0,n=this.array,o=n.length,i=this.scheduler;if(i)return i.schedule(e.dispatch,0,{array:n,index:r,count:o,subscriber:t});for(var s=0;s<o&&!t.closed;s++)t.next(n[s]);t.complete()},e}(ee.Observable),se=ie,ce={ArrayObservable:se},ue=_&&_.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},he=st,ae=function(t){function e(){t.apply(this,arguments)}return ue(e,t),e.prototype.notifyNext=function(t,e,r,n,o){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(he.Subscriber),pe=ae,be={OuterSubscriber:pe},le=h,fe={isPromise:le},de=S,ye=a,ve=a(de.root),we={symbolIteratorPonyfill:ye,$$iterator:ve},_e=_&&_.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},me=st,Se=function(t){function e(e,r,n){t.call(this),this.parent=e,this.outerValue=r,this.outerIndex=n,this.index=0}return _e(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(me.Subscriber),xe=Se,Oe={InnerSubscriber:xe},Ee=S,ge=g,je=fe,Pe=P,Te=St,$e=we,Ue=Oe,Ae=dt,Ie=p,Me={subscribeToResult:Ie},ke=_&&_.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},Re=be,Ye=Me,Ce=b,Ne=function(){function t(t){this.concurrent=t}return t.prototype.call=function(t,e){return e._subscribe(new Fe(t,this.concurrent))},t}(),Ve=Ne,Fe=function(t){function e(e,r){t.call(this,e),this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0}return ke(e,t),e.prototype._next=function(t){this.active<this.concurrent?(this.active++,this.add(Ye.subscribeToResult(this,t))):this.buffer.push(t)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(Re.OuterSubscriber),We=Fe,ze={mergeAll:Ce,MergeAllOperator:Ve,MergeAllSubscriber:We},Je=Zt,qe=ce,Be=ze,De=l,Ge=f,He={concat:De,concatStatic:Ge},Ke=ce,Le=Dt,Qe=Qt,Xe=He,Ze=Zt,tr=d,er={startWith:tr},rr=St,nr=er;rr.Observable.prototype.startWith=nr.startWith;var or=_&&_.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},ir=st,sr=y,cr=function(){function t(t,e,r){void 0===r&&(r=!1),this.accumulator=t,this.seed=e,this.hasSeed=r}return t.prototype.call=function(t,e){return e._subscribe(new ur(t,this.accumulator,this.seed,this.hasSeed))},t}(),ur=function(t){function e(e,r,n,o){t.call(this,e),this.accumulator=r,this._seed=n,this.hasSeed=o,this.index=0}return or(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){return this.hasSeed?this._tryNext(t):(this.seed=t,void this.destination.next(t))},e.prototype._tryNext=function(t){var e,r=this.index++;try{e=this.accumulator(this.seed,t,r)}catch(t){this.destination.error(t)}this.seed=e,this.destination.next(e)},e}(ir.Subscriber),hr={scan:sr},ar=St,pr=hr;ar.Observable.prototype.scan=pr.scan,t.createRxStore=v,Object.defineProperty(t,"__esModule",{value:!0})});
